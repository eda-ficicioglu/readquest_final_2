{% extends "_base.html" %}

{% block title %}Your Profile{% endblock %}

{% block content %}
    <h1>Hi, {{ user.username }}!</h1>

    <div class="timer-section">
        <h2>Reading Timer</h2>
        <p>Set a timer to focus on your reading!</p>
        <div id="timer-display">25:00</div>
        <button id="start-timer">Start</button>
        <button id="pause-timer">Pause</button>
        <button id="reset-timer">Reset</button>
    </div>

    <hr>

    <h2>Your Saved Books</h2>
    {% if saved_books %}
        {% for book in saved_books %}
        <div class="book-card">
            {% if book.thumbnail %}
                <img src="{{ book.thumbnail }}" alt="{{ book.title }} Cover" style="width:100px; float:left; margin-right:20px;">
            {% endif %}
            <h3>{{ book.title }}</h3>
            <p><strong>Author:</strong> {{ book.author }}</p>
        </div>
        <div style="clear:both; margin-bottom: 20px;"></div>
        {% endfor %}
    {% else %}
        <p>You haven't saved any books yet. <a href="{{ url_for('main.quiz') }}">Take the quiz</a> to get recommendations!</p>
    {% endif %}

    <hr>

    <h2>Your Past Test Results</h2>
    {% if test_results %}
        <ul>
        {% for result in test_results %}
            <li>On {{ result.timestamp.strftime('%Y-%m-%d') }}, your result was: <strong>{{ result.reader_type }}</strong> (Score: {{ result.score }})</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>You have no test results yet.</p>
    {% endif %}

<script>
    let timer;
    let timeLeft = 25 * 60; // 25 minutes in seconds
    let isPaused = true;
    const timerDisplay = document.getElementById('timer-display');

    function updateDisplay() {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTimer() {
        if (isPaused) {
            isPaused = false;
            timer = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                } else {
                    clearInterval(timer);
                    alert("Time's up!");
                }
            }, 1000);
        }
    }

    function pauseTimer() {
        isPaused = true;
        clearInterval(timer);
    }

    function resetTimer() {
        isPaused = true;
        clearInterval(timer);
        timeLeft = 25 * 60;
        updateDisplay();
    }

    document.getElementById('start-timer').addEventListener('click', startTimer);
    document.getElementById('pause-timer').addEventListener('click', pauseTimer);
    document.getElementById('reset-timer').addEventListener('click', resetTimer);

    updateDisplay(); // Initial display
</script>
{% endblock %}